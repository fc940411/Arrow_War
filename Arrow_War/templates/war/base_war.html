<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PVE</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <script type="text/javascript" src="/static/js/jQuery-3.4.1.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/static/css/main.css">

</head>
<body class='background'>
    <div class="row">
        <div class="col-xs-10 col-xs-offset-1 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 title_war">
            <div class='war_head'>积分:0 </div>
            <div class='war_head'><input class="btn btn-danger logout" type="button" value="退出" id="logout"></div>
        </div>   
    </div>

    <div class="row">
        <div class="col-xs-10 col-xs-offset-1 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 col-lg-6 col-lg-offset-3 vision">
            <div class='map'>
                <div class='glyphicon glyphicon-chevron-up hero'></div>
            </div>
        </div>   
    </div>

    <script type="text/javascript">
        $(function(){
            var visoin_x = $('.vision').width()
            var speed = 5
            var enemy_speed = 5
            var angle = 0
            var x_hero = 493
            var y_hero = 493
            var x_map = -(500-visoin_x/2)
            var y_map = -250
            var enemy_num = 1
            $('.war_head').css({
                'margin-left':'30px',
                'font-size':'15px',
                'height':'40px',
                'line-height':'40px',
                'display':'inline',
                'text-align':'center',
            })

            $('.logout').css({
                'margin-top':'3px',
                'margin-right':'30px',
                'float':'right',
            })

            // 初始化飞机位置

            $('.hero').css({
                'left': x_hero+'px',
                'top': y_hero+'px',
            })
            $('.map').css({
                'left': x_map+'px',
                'top': y_map+'px',
            })

            $(window).keydown(function (event) {
                if(String.fromCharCode(event.which)=='A'){
                    angle = angle - 3
                }

                if(String.fromCharCode(event.which)=='D'){
                    angle = angle + 3
                }
            })

            function move(){
                x = speed * Math.sin(Math.PI*angle/180)
                y = speed * Math.cos(Math.PI*angle/180)
                x_hero=x_hero+x
                y_hero=y_hero-y
                x_map=x_map-x
                y_map=y_map+y
                $('.hero').css({
                    'left': x_hero+'px',
                    'top': y_hero+'px',
                })
                $('.map').css({
                    'left': x_map+'px',
                    'top': y_map+'px',
                })
                $('.hero').css({
                    'transform-origin':'50% 50%',
                    'transform':'rotate('+angle+'deg)',
                })
                if(Math.pow((x_hero+7-500),2)+Math.pow((y_hero+7-500),2)>Math.pow(500,2)){
                    window.location.href = '/users/personal'
                    alert('您已坠毁!')
                }
            }
            // setInterval(move,60)

            function enemy_create(){
                var random = Math.random()*1000
                var enemy_x = 0
                var enemy_y = 0
                if(random>=0&random<250){
                    enemy_x = 4*random
                    enemy_y = -50
                    enemy_angle = 0
                }else if(random>=250&random<500){
                    enemy_x = 4*(random-250)
                    enemy_y = 1050
                    enemy_angle = 180
                }else if(random>=500&random<750){
                    enemy_x = 0
                    enemy_y = 4*(random-500)
                    enemy_angle = 90
                }else if(random>=750&random<=1000){
                    enemy_x = 1050
                    enemy_y = 4*(random-750)
                    enemy_angle = 270
                }
                enemy_num = enemy_num + 1
                $('.map').append("<div class='glyphicon glyphicon-chevron-down enemy' id='enemy"+enemy_num+"'></div>")
                $('#enemy'+enemy_num).css({
                    'left':enemy_x+'px',
                    'top':enemy_y+'px',
                    'transform-origin':'50% 50%',
                    'transform':'rotate('+enemy_angle+'deg)',
                    'z-index':enemy_num,
                }) 
                $('#enemy'+enemy_num).data({
                    'angle':enemy_angle
                }) 
            }
            setInterval(enemy_create,100)

            function enemy_move(){
                $('.enemy').each(function(){
                    var enemy_x = $(this).position().left
                    var enemy_y = $(this).position().top
                    var enemy_angle = $(this).data('angle')
                    enemy_x = enemy_x + enemy_speed * Math.sin(Math.PI*enemy_angle/180)
                    enemy_y = enemy_y + enemy_speed * Math.cos(Math.PI*enemy_angle/180)
                    if(enemy_x>1050|enemy_y>1050|enemy_x<-50|enemy_y<-50){
                        $(this).remove()
                    }
                    $(this).css({
                        'left':enemy_x+'px',
                        'top':enemy_y+'px',
                        'transform-origin':'50% 50%',
                        'transform':'rotate('+enemy_angle+'deg)',
                    })
                })
            }
            setInterval(enemy_move,60)
            
        })
        
    </script>
</body>
</html>